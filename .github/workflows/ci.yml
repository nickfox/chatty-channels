name: macOS build & test

on: [push, pull_request]

jobs:
  build:
    runs-on: macos-13
    steps:
      - name: Checkout sources
        uses: actions/checkout@v4

      - name: Set up Xcode
        uses: maxim-lobanov/setup-xcode@v1.6.0
        with:
          xcode-version: "14.3.1"

      - name: Build ControlRoom target
	    working-directory: ./ChattyChannels
        run: |
          xcodebuild -project ChattyChannels.xcodeproj \
                     -scheme ControlRoom \
                     -configuration Debug \
                     build CODE_SIGNING_ALLOWED=NO

      - name: Run unit tests
	    working-directory: ./ChattyChannels
        run: |
          xcodebuild test -project ChattyChannels.xcodeproj \
                          -scheme ControlRoom \
                          -destination 'platform=macOS' \
                          CODE_SIGNING_ALLOWED=NO


